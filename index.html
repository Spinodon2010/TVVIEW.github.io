<!DOCTYPE html>
<html>
<head>
  <title>Client</title>
</head>
<body>
  <h2>Camera Feed Sending...</h2>
  
  <!-- Video stream from webcam -->
  <video id="video" width="320" height="240" autoplay></video>
  
  <!-- Button to capture -->
  
  <!-- Canvas to draw the captured frame -->
  <canvas id="canvas" width="320" height="240"></canvas>
  
  <script defer>
    const socket = new WebSocket("ws://192.168.1.216:8000");


socket.onopen = () => {
    socket.send(capture());
};

socket.onmessage = (event) => {

    // const blob = new Blob([event.data], { type: "image/png" });
    // const url = URL.createObjectURL(blob);

    // images[1].src = images[0].src;
    // images[0].src = url;

    // setTimeout(() => {
    //     socket.send(capture);
    // }, 1000/32)


    // console.log("Buffer recieved");
    socket.send(capture());

};

socket.onclose = () => {
  
};


const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const snapBtn = document.getElementById('snap');
const context = canvas.getContext('2d');

// Ask for camera access
navigator.mediaDevices.getUserMedia({ video: true })
  .then(stream => {
    video.srcObject = stream; // Show webcam stream in <video>
  })
  .catch(err => {
    console.error("Error accessing camera:", err);
  });

// Capture frame when button is clicked
function capture() {
    context.drawImage(video, 0, 0, canvas.width, canvas.height);
  
  // convert to binary
    canvas.toBlob((blob) => {
    blob.arrayBuffer().then(buffer => {
      socket.send(buffer); // send raw binary
    });
  }, "image/png");


    return imageData;
}

  </script>
</body>
</html>
